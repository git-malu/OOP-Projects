package client.clientModel.task;

import java.rmi.RemoteException;

import provided.compute.ILocalTaskViewAdapter;
import provided.compute.ITask;
import provided.compute.ITaskResultFormatter;

public class MultiTask implements ITask<Object[]> {

	/**
	 * The serialVersionUID of this MultiTask
	 */
	private static final long serialVersionUID = -4084475870529481306L;

	private ITask<? extends Object> task1;

	private ITask<? extends Object> task2;

	private ILocalTaskViewAdapter taskViewAdapter;

	public MultiTask(ITask<? extends Object> task1, ITask<? extends Object> task2) {
		this.task1 = task1;
		this.task2 = task2;
	}

	@Override
	public Object[] execute() throws RemoteException {
		taskViewAdapter.append("MultiTask executing...\n");
		return new Object[] { task1.execute(), task2.execute() };
	}

	@Override
	public void setTaskViewAdapter(ILocalTaskViewAdapter viewAdapter) {
		this.taskViewAdapter = viewAdapter;
		task1.setTaskViewAdapter(viewAdapter);
		task2.setTaskViewAdapter(viewAdapter);
	}

	@Override
	public ITaskResultFormatter<Object[]> getFormatter() {
		return new ITaskResultFormatter<Object[]>() {
			@SuppressWarnings("unchecked")
			ITaskResultFormatter<Object> formatter1 = (ITaskResultFormatter<Object>) task1.getFormatter();
			@SuppressWarnings("unchecked")
			ITaskResultFormatter<Object> formatter2 = (ITaskResultFormatter<Object>) task2.getFormatter();

			@Override
			public String format(Object[] arr) {
				String res = "MultiTask results:\n" + "task: " + formatter1.format(arr[0]) + "\n" + "task: "
						+ formatter2.format(arr[1]);
				return res;
			}
		};
	}
}
