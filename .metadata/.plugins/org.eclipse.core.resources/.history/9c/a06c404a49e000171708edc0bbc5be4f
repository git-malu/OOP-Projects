package lm44_xw47.view;

import javax.swing.JPanel;
import map.MapPanel;
import javax.swing.JComboBox;
import javax.swing.JTextField;
import javax.swing.JButton;
import map.IRightClickAction;
import gov.nasa.worldwind.geom.Position;
import map.MapLayer;
import gov.nasa.worldwind.layers.RenderableLayer;
import gov.nasa.worldwind.layers.MarkerLayer;

/**
* Following defines the class for the map view.
 * 
 * @author Lu Ma
 * @author Xiaojun Wu
 *  *
 * @param <CBType> Type */
public class MapView<CBType> extends JPanel {
	private static final long serialVersionUID = -1046744381305932964L;

	private JPanel _ctrlPanel;
	private MapPanel _mapPanel;
	private JComboBox<CBType> _places;
	private JTextField _latField;
	private JButton _goLatLong;
	private JTextField _longField;
	private JButton _gotoBtn;
	private IMapView2MapModelAdapter<CBType> _adpt;

	/**
	* Constructor.
	 * 	 * 
	 * 	 * @param adpt The adpater this view used to communicate with model.
	 * 	 * @param rightClick The action defines right click action. */
	public MapView(IMapView2MapModelAdapter<CBType> adpt, IRightClickAction rightClick) {
		super();
		_adpt = adpt;
		//_rightClick = rightClick;
		initGUI(rightClick);
	}

	/**
	* Initializes the map GUI.
	 * 	 * 
	 * 	 * @param rightClick  The action defines right click action. */
	private void initGUI(IRightClickAction rightClick) {
		try {
			setLayout(new BorderLayout(0, 0));
			//setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);

			_ctrlPanel = new JPanel();
			FlowLayout jPanel1Layout = new FlowLayout();
			_ctrlPanel.setLayout(jPanel1Layout);
			add(_ctrlPanel, BorderLayout.SOUTH);
			//_ctrlPanel.setPreferredSize(new java.awt.Dimension(390, 43));
			_ctrlPanel.setBackground(new java.awt.Color(128, 255, 128));

			_latField = new JTextField();
			_ctrlPanel.add(_latField);
			_latField.setText("latitude");
			//_latField.setPreferredSize(new java.awt.Dimension(88, 22));

			_longField = new JTextField();
			_ctrlPanel.add(_longField);
			_longField.setText("longitude");

			_goLatLong = new JButton();
			_ctrlPanel.add(_goLatLong);
			_goLatLong.setText("Go!");
			_goLatLong.addActionListener(new ActionListener() {
				public void actionPerformed(ActionEvent evt) {
					_adpt.goLatLong(_latField.getText(), _longField.getText());
					_mapPanel.repaint();
				}
			});

			_places = new JComboBox<CBType>();
			_ctrlPanel.add(_places);

			_gotoBtn = new JButton();
			_ctrlPanel.add(_gotoBtn);
			_gotoBtn.setText("Go!");
			_gotoBtn.addActionListener(new ActionListener() {
				public void actionPerformed(ActionEvent evt) {
					_adpt.goPlace(_places.getItemAt(_places.getSelectedIndex()));
					_mapPanel.repaint();
				}
			});

			_mapPanel = new MapPanel(Earth.class);
			add(_mapPanel, BorderLayout.CENTER);

			//_mapPanel.setPreferredSize(new java.awt.Dimension(600, 400));
			_mapPanel.addRightClickAction(rightClick);

			//pack();
		} catch (Exception e) {
			//add your error handling code here
			e.printStackTrace();
		}
	}

	/**
	* Start the map GUI. */
	public void start() {
		_mapPanel.start();
		//setLocationRelativeTo(null);
		setVisible(true);
	}

	/**
	* Set the position by given position.
	 * 	 * 
	 * 	 * @param pos The positon being set. */
	public void setPosition(Position pos) {
		_mapPanel.setPosition(pos, true);
	}

	/**
	* Add the given layer to map panel.
	 * 	 * 
	 * 	 * @param layer The layer being added to map panel. */
	public void addMapLayer(MapLayer layer) {
		_mapPanel.addLayer(layer);
	}

	/**
	* add a renderable layer to the map panel
	 * 	 * @param layer */
	public void addRenderableLayer(RenderableLayer layer) {
		_mapPanel.addLayer(layer);
	}

	public void addMarkerLayer(MarkerLayer layer) {
		_mapPanel.addLayer(layer);
	}

	/**
	* Remove the given layer from map panel.
	 * 	 * 
	 * 	 * @param layer The layer being removed from map panel. */
	public void removeMapLayer(MapLayer layer) {
		_mapPanel.removeLayer(layer);
	}

	/**
	* Add the given place to select list.
	 * 	 * 
	 * 	 * @param p The place being added to select list. */
	public void addPlace(CBType p) {
		_places.insertItemAt(p, 0);
		_places.setSelectedIndex(0);
	}

}
